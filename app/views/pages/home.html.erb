<div class="max-w-xl mx-auto mt-10 px-4">
  <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">🔍 Search Articles</h1>

  <input
    type="text"
    id="search-box"
    placeholder="Start typing..."
    autocomplete="off"
    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
  />

  <p id="status" class="mt-3 text-sm text-green-600 font-medium text-center"></p>

  <div class="mt-6 text-center">
    <a href="/analytics" class="inline-block text-blue-600 hover:underline text-lg">
      📊 View My Search Analytics
    </a>
  </div>
</div>
<script>
  function debounce(func, delay) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), delay);
    };
  }

  document.addEventListener("turbo:load", () => {
    const searchBox = document.getElementById("search-box");
    const status = document.getElementById("status");

    if (!searchBox) return;

    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    const sendSearch = debounce((query) => {
      if (query.length <= 2) return;

      fetch("/searches", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": csrfToken
        },
        body: JSON.stringify({ query: query })
      }).then((res) => {
        if (res.ok) {
          status.textContent = `Saved: "${query}"`;
        } else {
          status.textContent = `Error saving search`;
        }
      }).catch(() => {
        status.textContent = `Network error`;
      });
    }, 600);

    searchBox.addEventListener("input", (e) => {
      const query = e.target.value.trim();
      sendSearch(query);
    });
  });
</script>
